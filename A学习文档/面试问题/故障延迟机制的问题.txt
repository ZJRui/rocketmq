 消息队列如何进行负载， 消息发送如何选择发送到哪个消息队列呢？
比如一个Topic有4个消息队列，一共有两个broker，因此每一个broke中有两个消息队列，选择消息队列其实也意味着选择发送到哪个Borker。

选择消息队列有两种方式，不启用Broker故障延迟机制 和启用Broker故障延迟机制。
默认是不启用故障延迟机制，此时生产者使用轮训方式选择消息队列，在选择过程中会根据记录的上一次发送失败Borker的名称来规避再次选择该broker上的消息消费队列； 因此第一次发送失败时，第二次选择消息队列能够规避第一次的broker，但是第三选择消息队列时无法规避第一次选择的broker。而且当你发送另一个消息的时候很有可能还会选择到宕机的broker。虽然你可以使用set集合来保存所有失败的broker，但是当你下次发送另一个消息的时候还是无法避免选择宕机的broker

问题：为什么不是统一记录所有失败的broker来规避？  可以记录，但是还是无法 规避 发送另一个消息时选择宕机broker
那么有什么办法可以在一次消息发送失败后能够暂时将该broker排除在可选范围外呢》？这里所谓的暂时 可以满足 多次发送不同消息的需求
附带：既然都可以避免故障的broker，那么是否还有必要使用故障延迟机制？
要注意的是，避免故障的broker是在一次消息发送中的多次重试中发生的，并不能避免多次消息发送中选择故障的broker。那么我们就需要一种机制来预防这种问题。



故障延迟机制：能够实现在一次消息发送失败后 暂时将该broker的消息队列排除在可选范围之外
故障延迟机制的原理就是：消息发送失败的是时候 创建一条发送失败记录，记录broker和故障延迟时间，故障延迟时间就是broker要规避 的时长（指定该broker在未来的故障延迟时间内不能发送消息）。这个故障延迟时间 可以使用固定的30秒，也可以根据消息发送开始时间到消息发送失败时的差值时间 来计算一个时间作为故障延迟时间，故障延迟时间就是broker要规避 的时长。


为什么broker不可用后，路由信息中还会有包含该broker的路由信息呢？
NameServer检测Broker是否可用是有延迟的，其次NameServer不会检测到Broker宕机后马上推送消息给生产者，而是消息生产者每隔30秒更新一次路由信息。
